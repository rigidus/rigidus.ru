<!DOCTYPE html>
<html>
<head>
<title>Руководство по кастомизации Emacs</title>
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="rigidus">
<link href="/css/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="content">
<h1 class="title">Руководство по кастомизации Emacs</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Интро</a></li>
<li><a href="#sec-2">Cedet</a>
<ul>
<li><a href="#sec-2-1">Инсталляция</a></li>
<li><a href="#sec-2-2">Компиляция в Emacs-e</a></li>
<li><a href="#sec-2-3">Настройка</a></li>
</ul>
</li>
<li><a href="#sec-3">Emacs Code Browser</a>
<ul>
<li><a href="#sec-3-1">Инсталляция</a></li>
<li><a href="#sec-3-2">Конфигурирование</a></li>
</ul>
</li>
<li><a href="#sec-4">Color-theme</a></li>
<li><a href="#sec-5">Комментирование и поиск</a></li>
<li><a href="#sec-6">Cua-mode</a></li>
<li><a href="#sec-7">Emacs-Jabber</a>
<ul>
<li><a href="#sec-7-1">Инсталляция</a></li>
<li><a href="#sec-7-2">Настройка</a></li>
</ul>
</li>
<li><a href="#sec-8">Wanderlust.</a>
<ul>
<li><a href="#sec-8-1">Установка</a></li>
<li><a href="#sec-8-2">Конфигурирование</a></li>
</ul>
</li>
<li><a href="#sec-9">MailCrypt</a>
<ul>
<li><a href="#sec-9-1">Инсталляция</a></li>
<li><a href="#sec-9-2">Использование</a></li>
</ul>
</li>
<li><a href="#sec-10">lj-update</a></li>
<li><a href="#sec-11">MetaJump</a></li>
<li><a href="#sec-12">Мои мinor-режимы</a>
<ul>
<li><a href="#sec-12-1">Настройка</a></li>
</ul>
</li>
<li><a href="#sec-13">Русификация Емакса</a></li>
<li><a href="#sec-14">Полезные мелочи</a></li>
<li><a href="#sec-15">uniquify</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Интро</h2>
<div class="outline-text-2" id="text-1">
<p>
Сегодня мы установим в наш <code>emacs</code> все необходимое, начиная с
настоящего комбайна, который называтся <code>Cedet</code>.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Cedet</h2>
<div class="outline-text-2" id="text-2">
<p>
Пакет <code>Cedet</code> объединяет
в своем составе несколько пакетов, реализующих различную
функциональность, но объединенных вокруг одной задачи по работе с
исходным кодом на различных языках программирования.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Инсталляция</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Берем тарбол с официального репозитория
<a href="http://cedet.cvs.sourceforge.net/viewvc/cedet/">http://cedet.cvs.sourceforge.net/viewvc/cedet/</a> и распаковываем его в
~/.emacs.d/cedet
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Компиляция в Emacs-e</h3>
<div class="outline-text-3" id="text-2-2">
<p>
После этого заходим туда и отдаем команду
</p>

<div class="org-src-container">

<pre class="src src-sh">emacs -Q -l cedet-build.el -f cedet-build
</pre>
</div>

<p>
Таким нетривиальным образом, через emacs, оказывается можно собрать и
скомпилить cedet.
</p>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Настройка</h3>
<div class="outline-text-3" id="text-2-3">
<p>
После завершения компиляции добавляем в init.el
следующие строки:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">Load CEDET.</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">See cedet/common/cedet.info for configuration details.</span>
(load-file <span style="color: #87005f;">"~/.emacs.d/cedet/common/cedet.el"</span>)

<span style="color: #af0000;">;; </span><span style="color: #af0000;">Enable EDE (Project Management) features</span>
(global-ede-mode 1)

<span style="color: #af0000;">;; </span><span style="color: #af0000;">Enable EDE for a pre-existing C++ project</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(ede-cpp-root-project "NAME" :file "~/myproject/Makefile")</span>

<span style="color: #af0000;">;; </span><span style="color: #af0000;">Enabling Semantic (code-parsing, smart completion) features</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">Select one of the following:</span>

<span style="color: #af0000;">;; </span><span style="color: #af0000;">* This enables the database and idle reparse engines</span>
(semantic-load-enable-minimum-features)

<span style="color: #af0000;">;; </span><span style="color: #af0000;">* This enables some tools useful for coding, such as summary mode</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">imenu support, and the semantic navigator</span>
(semantic-load-enable-code-helpers)

<span style="color: #af0000;">;; </span><span style="color: #af0000;">* This enables even more coding tools such as intellisense mode</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">decoration mode, and stickyfunc mode (plus regular code helpers)</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(semantic-load-enable-gaudy-code-helpers)</span>

<span style="color: #af0000;">;; </span><span style="color: #af0000;">* This enables the use of Exuberent ctags if you have it installed.</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">If you use C++ templates or boost, you should NOT enable it.</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(semantic-load-enable-all-exuberent-ctags-support)</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">Or, use one of these two types of support.</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">Add support for new languges only via ctags.</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(semantic-load-enable-primary-exuberent-ctags-support)</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">Add support for using ctags as a backup parser.</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(semantic-load-enable-secondary-exuberent-ctags-support)</span>

<span style="color: #af0000;">;; </span><span style="color: #af0000;">Enable SRecode (Template management) minor-mode.</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(global-srecode-minor-mode 1)</span>

<span style="color: #af0000;">;; </span><span style="color: #af0000;">from yakor_spb@emacs.conference.jabber.ru</span>
(semantic-load-enable-excessive-code-helpers)

<span style="color: #af0000;">;; </span><span style="color: #af0000;">Code Folding ; http://alexott-ru.blogspot.com/2009/01/blog-post.html</span>
(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">my-semantic-hook</span> ()
  (semantic-tag-folding-mode 1))
(add-hook 'semantic-init-hooks 'my-semantic-hook)
</pre>
</div>

<p>
Теперь можно получить настоящее удовольствие при программировании!
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Emacs Code Browser</h2>
<div class="outline-text-2" id="text-3">
<p>
Добавляем в CEDET EmacsCodeBrowser, который превращает emacs в
многоязыковую IDE.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Инсталляция</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Берем снапшот из &lt;a href="<a href="http://ecb.sourceforge.net/cvs_snapshots/ecb.tar.gz">http://ecb.sourceforge.net/cvs_snapshots/ecb.tar.gz</a>"&gt;официального
репозитория&lt;/a&gt; и распаковываем в &lt;code&gt;~/.emacs.d/ecb&lt;/code&gt;
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Конфигурирование</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Добавляем в конфиграционный файл Емакса следующие строчки:
</p>

<div class="org-src-container">

<pre class="src src-sh">;; Load ECB
(add-to-list <span style="color: #87005f;">'load-path "~/.emacs.d/ecb")</span>
<span style="color: #87005f;">(require '</span>ecb-autoloads)
(global-set-key (kbd <span style="color: #87005f;">"C-x p"</span>) <span style="color: #87005f;">'ecb-activate)</span>
<span style="color: #87005f;">(global-set-key (kbd "C-x j") '</span>ecb-deactivate)
(global-set-key (kbd <span style="color: #87005f;">"C-x ,"</span>) <span style="color: #87005f;">'ecb-toggle-ecb-windows)</span>
<span style="color: #87005f;">(global-set-key (kbd "\e\eg") '</span>goto-line)
(global-set-key [?\M-g] <span style="color: #87005f;">'goto-line)</span>
<span style="color: #87005f;">(define-key global-map (kbd "C-&lt;tab&gt;") '</span>workspace-controller)
(setq ecb-tip-of-the-day nil)
(setq ecb-prescan-directories-for-emptyness nil)
</pre>
</div>

<p>
После этого перезапускаем Емакс и даем команду &lt;code&gt;M-x ecb-byte-compile&lt;/code&gt;,
которая ускорит загрузку нашей среды программирования.
</p>

<p>
Теперь, чтобы запустить ECB можно нажать &lt;code&gt;C-x p&lt;/code&gt; А чтобы скрыть &lt;code&gt;C-x&lt;/code&gt; ,
Ну а если вы хотите вообще выключить ECB - &lt;code&gt;C-x j&lt;/code&gt; При желании вы можете настроить свои
комбинации клавиш.
</p>

<p>
Продуктивной работы!
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Color-theme</h2>
<div class="outline-text-2" id="text-4">
<p>
Время раскрасить наш emacs! Берем архив с темами и плагином (файл
color-theme.el.gz) тут: <a href="http://download.gna.org/color-theme/">http://download.gna.org/color-theme/</a>
</p>

<p>
Потом распаковываем в папку &lt;code&gt;~/.emacs.d/&lt;/ode&gt;
</p>

<p>
В файл <code>~/.emacs.d/init.el</code> добавляем следующий код:
</p>

<div class="org-src-container">

<pre class="src src-lisp">(add-to-list 'load-path <span style="color: #87005f;">"~/.emacs.d/"</span>) <span style="color: #af0000;">; &#1076;&#1086;&#1073;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084; &#1087;&#1091;&#1090;&#1100; &#1082; &#1092;&#1072;&#1081;&#1083;&#1072;&#1084; &#1088;&#1072;&#1089;&#1096;&#1080;&#1088;&#1077;&#1085;&#1080;&#1081;</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://habrahabr.ru/blogs/emacs/25854/</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://download.gna.org/color-theme/</span>
(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">color-theme</span>) <span style="color: #af0000;">; &#1087;&#1086;&#1076;&#1075;&#1088;&#1091;&#1078;&#1072;&#1077;&#1084; "&#1084;&#1086;&#1076;&#1091;&#1083;&#1100; &#1088;&#1072;&#1089;&#1082;&#1088;&#1072;&#1089;&#1082;&#1080;"</span>
(color-theme-robin-hood) <span style="color: #af0000;">; &#1074;&#1099;&#1073;&#1088;&#1072;&#1090;&#1100; &#1082;&#1086;&#1085;&#1082;&#1088;&#1077;&#1090;&#1085;&#1091;&#1102; &#1089;&#1093;&#1077;&#1084;&#1091;</span>
</pre>
</div>

<p>
Последнюю строчку можно заменить на любую из тем, которая вам
понравится, их там очень много. Чтобы просмотреть некоторые из них
выполните M-x color-theme-[TAB] и автодополнение вам поможет!
</p>

<p>
Здесь нужны некоторые пояснения. В емаксе есть переменная <code>load-path</code>,
которая хранит список путей, где будут искаться расширения, при
попытке их загрузить с помощью (require 'расширение) когда вы
вызываете add-to-list вы добавляете к этому списку свой путь. После
этого require найдет нужно расширение в файле "расширение.el" и
выполнит его так же, как если бы оно было включено в
init.el. Соответственно все определенные в этом расширении функции
станут доступны.
</p>

<p>
Кстати, вы всегда можете посмотрель любую переменную, выполнив C-h v
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Комментирование и поиск</h2>
<div class="outline-text-2" id="text-5">
<p>
Перед тем, как добавить следующее расширение улучшим наш Emacs еще
двумя маленькими функциями. Первая из них позволяет удобно работать с
комменариями - нужно просто нажать C-\ а вторая помогает искать
текст. Испробуйте эти небольшие расширения самостоятельно (код лучше
вставить до блока EXTENSIONS
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">Comment function</span>
(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">comment-or-uncomment-this</span> (<span style="color: #008700;">&amp;optional</span> lines)
  (interactive <span style="color: #87005f;">"P"</span>)
  (<span style="color: #af00ff;">if</span> mark-active
      (<span style="color: #af00ff;">if</span> (&lt; (mark) (point))
          (comment-or-uncomment-region (mark) (point))
          (comment-or-uncomment-region (point) (mark)))
      (comment-or-uncomment-region
       (line-beginning-position)
       (line-end-position lines))))

(global-set-key (kbd <span style="color: #87005f;">"C-;"</span>) 'comment-or-uncomment-this)


<span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1055;&#1086;&#1080;&#1089;&#1082; &#1086;&#1090; kostafey C-f|C-r C-v</span>
(global-unset-key <span style="color: #87005f;">"\C-f"</span>)
(global-set-key <span style="color: #87005f;">"\C-f"</span> 'isearch-forward)
(global-set-key <span style="color: #87005f;">"\C-r"</span> 'isearch-backward)
(add-hook 'isearch-mode-hook
          '(<span style="color: #af00ff;">lambda</span> ()
             (<span style="color: #af00ff;">define-key</span> isearch-mode-map <span style="color: #87005f;">"\C-f"</span>
               'isearch-repeat-forward)
             (<span style="color: #af00ff;">define-key</span> isearch-mode-map <span style="color: #87005f;">"\C-r"</span>
               'isearch-repeat-backward)
             (<span style="color: #af00ff;">define-key</span> isearch-mode-map <span style="color: #87005f;">"\C-v"</span>
               'isearch-yank-kill)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Cua-mode</h2>
<div class="outline-text-2" id="text-6">
<p>
Когда вы запускаете Емакс вы видите перед собой окно текущего рабочего
буфера, которое занимает почти весь экран и так называемый
"минибуфер", в котором можно вводить разнообразные команды. Они
разделены строкой состояния, в которой показана информация о текущих
режимах работы Емакс.
</p>

<p>
Чтобы выйти в минибуфер и попробовать набрать так команду shell
нажмите M-x shell. По историческим причинам М - значит Alt, то есть вы
должны удерживая Alt нажать "x" и курсор переместиться в минибуффер,
где вы сможете набрать shell и завершить набор нажатием Enter. После
этого в рабочем буфере появится shell
</p>

<p>
Сейчас мы приступим к конфигурированию Емакса из самого
Емакса. Используя shell создайте каталог "~/.emacs.d" а в нем файл
"init.el" - это основной конфигурационный файл Емакса по умолчанию:
</p>

<div class="org-src-container">

<pre class="src src-sh">mkdir .e.d
<span style="color: #5f5f87;">cd</span> e.d
touch init.el
</pre>
</div>

<p>
Теперь время открыть этот файл в Емаксе. Наберите C-x C-f и введите
путь к файлу. Автодополнение работает при нажатии клавиши TAB
</p>

<p>
Начнем конфигурировать Емакс. Первое, что имеет смысл сделать
человеку, привыкшему к стандартным комбинациям клавиш для копипастинга
</p>
<ul class="org-ul">
<li>это настроить их. Запишем в наш init.el следующее:
</li>
</ul>

<div class="org-src-container">

<pre class="src src-sh">;; &#1059;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1082;&#1072; &#1088;&#1077;&#1078;&#1080;&#1084;&#1072; CUA &#1087;&#1086;&#1076;&#1076;&#1077;&#1088;&#1078;&#1082;&#1072; Ctr-c,v,x,d &#1082;&#1072;&#1082; &#1074; windows
;; CUA mode: C-x, C-c, C-v for copying, pasting, C-z for undo
(cua-mode t)
(transient-mark-mode 1) ;; No region when it is not highlighted
(setq cua-keep-region-after-copy t) ;; Standard Windows behaviour
;; &#1053;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1072; &#1087;&#1086;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1103; &#1088;&#1077;&#1076;&#1072;&#1082;&#1090;&#1086;&#1088;&#1072; <span style="color: #87005f;">"&#1082;&#1072;&#1082; &#1074; Windows"</span>
;; &#1085;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1072; &#1082;&#1083;&#1072;&#1074;&#1080;&#1072;&#1090;&#1091;&#1088;&#1099; &#1082;&#1072;&#1082; &#1074; Windows
;; Delete (and its variants) delete forward instead of backward.
;; C-Backspace kills backward a word (as C-Delete normally would)<span style="color: #5f5f87;">.</span>
;; M-Backspace does undo.
;; Home and End move to beginning and end of line
;; C-Home and C-End move to beginning and end of buffer.
;; C-Escape does list-buffers.<span style="color: #87005f;">"</span>
<span style="color: #87005f;">(pc-bindings-mode)</span>
<span style="color: #87005f;">;; &#1053;&#1072;&#1089;&#1090;&#1088;&#1086;&#1081;&#1082;&#1072; &#1074;&#1099;&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1103; "</span>&#1082;&#1072;&#1082; &#1074; Windows<span style="color: #87005f;">"</span>
<span style="color: #87005f;">(pc-selection-mode)</span>
<span style="color: #87005f;">(delete-selection-mode nil)</span>

<span style="color: #87005f;">;; Makes clipboard work</span>
<span style="color: #87005f;">(setq x-select-enable-clipboard t)</span>
<span style="color: #87005f;">(setq interprogram-paste-function 'x-cut-buffer-or-selection-value)</span>
<span style="color: #87005f;">(setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING))</span>
</pre>
</div>


<p>
Родные комбинации Емакса ничуть не менее удобны, и постепенно вы
откажетесь от cua-mode, но на первых порах проще работать так. Теперь
после перезагрузки Емакса видновая копипаста будет работать. Впрочем,
даже перезагрузка не требуется - поставьте курсор в конце каждой
строки и нажмите C-x C-e и изменения будут применены сразу же!
</p>

<p>
Для тех же, кто готов вместе со мной идти до конца - расскажу о родной
копипасте Емакса:
</p>

<table>


<colgroup>
<col  class="left">

<col  class="left">
</colgroup>
<tbody>
<tr>
<td class="left">Копировать</td>
<td class="left">M-w</td>
</tr>

<tr>
<td class="left">Вырезать</td>
<td class="left">C-w</td>
</tr>

<tr>
<td class="left">Вставить</td>
<td class="left">C-y</td>
</tr>

<tr>
<td class="left">Удалить от позиции курсора до конца строки</td>
<td class="left">C-k</td>
</tr>

<tr>
<td class="left">Отменить последнее действие (Undo)</td>
<td class="left">C-_</td>
</tr>

<tr>
<td class="left">Установить снять выделение</td>
<td class="left">C-Space</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Emacs-Jabber</h2>
<div class="outline-text-2" id="text-7">
<p>
Емакс - это не только редактор. Сейчас мы добавим к нему jabber -
систему мгновенных сообщений, которую все прогрессивное человечество
использует вместо попсовых мессенджеров
</p>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">Инсталляция</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Самый простой способ установить jabber - из репозиториев:
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install emacs-jabber
</pre>
</div>

<p>
Но я решил взять более свежий пакет из официального git`a и следовать
приведенным в файле README инструкциям
</p>

<div class="org-src-container">

<pre class="src src-sh">git clone git://emacs-jabber.git.sourceforge.net/gitroot/emacs-jabber/emacs-jabber
<span style="color: #5f5f87;">cd</span> emacs-jabber
autoreconf -a
sudo apt-get install texinfo <span style="color: #af0000;"># </span><span style="color: #af0000;">&#1077;&#1089;&#1083;&#1080; &#1085;&#1072;&#1076;&#1086; :)</span>
make
sudo make install
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">Настройка</h3>
<div class="outline-text-3" id="text-7-2">
<p>
В результате этих манипуляций у нас будет установленный свежий
emacs-jabber и нам останется только прописать в наш конфиг следующие
строки:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">JABBER</span>
(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">jabber</span>)
(setq jabber-auto-reconnect t)
(setq jabber-chat-buffer-format <span style="color: #87005f;">"*---%n-*"</span>)
(setq jabber-groupchat-buffer-format <span style="color: #87005f;">"*===%n-*"</span>)
(setq jabber-history-dir <span style="color: #87005f;">"~/.jabber-chatlogs"</span>)
(setq jabber-history-enabled t)
(setq jabber-history-muc-enabled t)
(setq jabber-history-size-limit 1024000000)
<span style="color: #af0000;">;; </span><span style="color: #af0000;">M-x jabber-edit-bookmarks - &#1076;&#1083;&#1103; &#1088;&#1077;&#1076;&#1072;&#1082;&#1090;&#1080;&#1088;&#1074;&#1072;&#1085;&#1080;&#1103; &#1079;&#1072;&#1082;&#1083;&#1072;&#1076;&#1086;&#1082;</span>
</pre>
</div>

<p>
Теперь после загрузки обновленного конфига достаточно нажать &lt;code&gt;C-x C-j
C-c&lt;/code&gt; и ваш jabber внутри емакса будет запущен. В списке буферов
появится jabber-roster с понятной инструкцией по добавлению и удалению
контактов, а для чего-то более сложного всегда есть M-x jabber-[TAB]
</p>

<p>
Приятного общения! (мой jid - rigidus@jabber.ru)
</p>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Wanderlust.</h2>
<div class="outline-text-2" id="text-8">
<p>
Теперь, когда у нас есть в Емаксе мессенджер, никто не мешает
подключить туда же и почту. Для Емакса написано несколько хороших
клиентов, но я пока попробовал только WanderLust. Он оказался очень
удобным и у меня пока нет желания переходить куда-то еще. Итак, начнем
с установки:
</p>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">Установка</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">

<pre class="src src-sh">sudo apt-get install wl
</pre>
</div>

<p>
У wanderlust-a неслабых размеров конфиг, причем начинать надо с
конфигурирования почтовых ящиков в специальном файле ~/.folder. Вот
его содержимое (имена ящиков я заменил, чтобы спаммеры не пронюхали :):
</p>

<div class="org-src-container">

<pre class="src src-lisp">rigidus@gmail.com {
    %inbox:rigidus@imap.gmail.com:993!         <span style="color: #87005f;">"inbox"</span>
}
avenger@yandex.ru {
    %inbox:avenger@imap.yandex.ru:993!            <span style="color: #87005f;">"inbox"</span>
    %alfa:avenger@imap.yandex.ru:993!             <span style="color: #87005f;">"alfa"</span>
    %alfa-order:avenger@imap.yandex.ru:993!       <span style="color: #87005f;">"alfa-order"</span>
    %ashmanov:avenger@imap.yandex.ru:993!         <span style="color: #87005f;">"ashmanov"</span>
    %errors:avenger@imap.yandex.ru:993!           <span style="color: #87005f;">"errors"</span>
    %job-list:avenger@imap.yandex.ru:993!         <span style="color: #87005f;">"job-list"</span>
    %lj:avenger@imap.yandex.ru:993!               <span style="color: #87005f;">"lj"</span>
    %self:avenger@imap.yandex.ru:993!             <span style="color: #87005f;">"self"</span>
    %vkontakte:avenger@imap.yandex.ru:993!        <span style="color: #87005f;">"vkontakte"</span>
    %work:avenger@imap.yandex.ru:993!             <span style="color: #87005f;">"work"</span>
}
</pre>
</div>

<p>
Как видите все imap папки указываются в специальном
формате. wanderlist так-же поддерживает и pop3, так что если у кого
есть конфиг - welcome в комментарии. А теперь посмотрим, как
конфигурируется все это добро в init.el
</p>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2">Конфигурирование</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">http://www.gohome.org/wl/doc/wl_95.html#SEC95</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://box.matto.nl/emacsgmail.html</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://www.emacswiki.org/emacs/hgw-init-wl.el</span>
(autoload 'wl <span style="color: #87005f;">"wl"</span> <span style="color: #87005f;">"Wanderlust"</span> t)
(autoload 'wl-other-frame <span style="color: #87005f;">"wl"</span> <span style="color: #87005f;">"Wanderlust on new frame."</span> t)
(autoload 'wl-draft <span style="color: #87005f;">"wl-draft"</span> <span style="color: #87005f;">"Write draft with Wanderlust."</span> t)

(setq mime-edit-split-message nil)

(setq wl-from <span style="color: #87005f;">"rigidus "</span>)
(setq elmo-imap4-default-user <span style="color: #87005f;">"rigidus"</span>
      elmo-imap4-default-server <span style="color: #87005f;">"imap.gmail.com"</span>
      elmo-imap4-default-port 993
      elmo-imap4-default-authenticate-type 'clear
      elmo-imap4-default-stream-type 'ssl
      elmo-imap4-use-modified-utf7 t

      wl-message-id-domain <span style="color: #87005f;">"rigidus@gmail.com"</span>
      wl-from <span style="color: #87005f;">"rigidus "</span>
      wl-smtp-posting-server <span style="color: #87005f;">"smtp.gmail.com"</span>
      wl-smtp-connection-type 'starttls
      wl-smtp-posting-port 587
      wl-smtp-authenticate-type <span style="color: #87005f;">"plain"</span>
      wl-smtp-posting-user <span style="color: #87005f;">"rigidus"</span>
      wl-local-domain <span style="color: #87005f;">"gmail.com"</span>

      elmo-pop3-debug t
      ssl-certificate-verification-policy 1
      wl-default-folder <span style="color: #87005f;">"%inbox"</span>
      wl-default-spec <span style="color: #87005f;">"%"</span>
      wl-folder-check-async t
      wl-thread-indent-level 4
      wl-thread-have-younger-brother-str <span style="color: #87005f;">"+"</span>
      wl-thread-youngest-child-str       <span style="color: #87005f;">"+"</span>
      wl-thread-vertical-str             <span style="color: #87005f;">"|"</span>
      wl-thread-horizontal-str           <span style="color: #87005f;">"-"</span>
      wl-thread-space-str                <span style="color: #87005f;">" "</span>
      wl-summary-width  nil
      wl-summary-line-format <span style="color: #87005f;">"%n%T%P %W %D-%M-%Y %h:%m %t%[%c %f% %] %s"</span>
      wl-message-buffer-prefetch-folder-type-list nil
      mime-transfer-level 8
      mime-edit-split-message nil
      mime-edit-message-max-length 32768
      mime-header-accept-quoted-encoded-words t
      mime-browse-url-function 'browse-url-conkeror
      pgg-passphrase-cache-expiry 300
      pgg-decrypt-automatically t
      wl-message-ignored-field-list '(<span style="color: #87005f;">"^.*"</span>)
      wl-message-visible-field-list '(<span style="color: #87005f;">"^From:"</span> <span style="color: #87005f;">"^To:"</span> <span style="color: #87005f;">"^Cc:"</span>
         <span style="color: #87005f;">"^Date:"</span> <span style="color: #87005f;">"^Subject:"</span> <span style="color: #87005f;">"^User-Agent:"</span> <span style="color: #87005f;">"^X-Mailer:"</span>)
      wl-message-sort-field-list    wl-message-visible-field-list
      wl-message-window-size '(1 . 3)
      wl-folder-window-width 40
      wl-draft-preview-attributes-buffer-lines 7
      wl-draft-config-alist
      '(
        ((string-match <span style="color: #87005f;">"avenger"</span> wl-draft-parent-folder)
         (wl-message-id-domain . <span style="color: #87005f;">"avenger@yandex.ru"</span>)
         (wl-from . <span style="color: #87005f;">"rigidus "</span>)
         (<span style="color: #87005f;">"From"</span> . <span style="color: #87005f;">"avenger@yandex.ru"</span>)
         <span style="color: #af0000;">;; </span><span style="color: #af0000;">("Fcc" . "%Sent:avenger@yandex.ru:993")</span>
         (wl-smtp-posting-server . <span style="color: #87005f;">"smtp.yandex.ru"</span>)
         <span style="color: #af0000;">;; </span><span style="color: #af0000;">(wl-smtp-connection-type . nil)</span>
         (wl-smtp-connection-type . 'starttls)
         <span style="color: #af0000;">;; </span><span style="color: #af0000;">(wl-smtp-connection-type . 'ssl)</span>
         <span style="color: #af0000;">;; </span><span style="color: #af0000;">(wl-smtp-posting-port . 25)</span>
         <span style="color: #af0000;">;; </span><span style="color: #af0000;">(wl-smtp-posting-port . 465)</span>
         (wl-smtp-posting-port . 587)
         (wl-smtp-authenticate-type . <span style="color: #87005f;">"plain"</span>)
         (wl-smtp-posting-user . <span style="color: #87005f;">"avenger"</span>)
         (wl-local-domain . <span style="color: #87005f;">"yandex.ru"</span>)
         )
        ((string-match <span style="color: #87005f;">"rigidus"</span> wl-draft-parent-folder)
         (wl-message-id-domain . <span style="color: #87005f;">"rigidus@gmail.com"</span>)
         (wl-from . <span style="color: #87005f;">"rigidus "</span>)
         (<span style="color: #87005f;">"From"</span> . <span style="color: #87005f;">"rigidus@gmail.com"</span>)
         <span style="color: #af0000;">;; </span><span style="color: #af0000;">("Fcc" . "%Sent:rigidus@imap.gmail.com:993")</span>
         (wl-smtp-posting-server . <span style="color: #87005f;">"smtp.gmail.com"</span>)
         (wl-smtp-connection-type . 'starttls)
         (wl-smtp-posting-port . 587)
         (wl-smtp-authenticate-type . <span style="color: #87005f;">"plain"</span>)
         (wl-smtp-posting-user . <span style="color: #87005f;">"rigidus"</span>)
         (wl-local-domain . <span style="color: #87005f;">"gmail.com"</span>)
         )
        )
      )

(autoload 'wl-user-agent-compose <span style="color: #87005f;">"wl-draft"</span> nil t)
(<span style="color: #af00ff;">if</span> (boundp 'mail-user-agent)
    (setq mail-user-agent 'wl-user-agent))
(<span style="color: #af00ff;">if</span> (fboundp 'define-mail-user-agent)
    (<span style="color: #af00ff;">define-mail-user-agent</span>
      'wl-user-agent
      'wl-user-agent-compose
      'wl-draft-send
      'wl-draft-kill
      'mail-send-hook))
</pre>
</div>

<p>
Как видите конфиг выглядит внушительно :) За рассшифровкой отдельных
полей обращайтесь к документации. Если же у кого-нибудь из читателей
есть конфиг подключения к какой-нибудь другой почте, кроме yandex-a и
gmail-ла - пожалуйста поделитесь настройками со мной!
</p>

<p>
После конфигурирования почтовый клиент можно запускать командой M-x wl
После того, как все пароли введены используйте команду
M-x elmo-passwd-alist-save чтобы сохранить их.
</p>

<p>
Основные клавиатурные комбинации можно узнать здесь: &lt;a
href="<a href="http://www.gohome.org/wl/doc/wl_82.html">http://www.gohome.org/wl/doc/wl_82.html</a>"&gt;<a href="http://www.gohome.org/wl/doc/wl_82.html">http://www.gohome.org/wl/doc/wl_82.html</a>&lt;/a&gt;
</p>
</div>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">MailCrypt</h2>
<div class="outline-text-2" id="text-9">
<p>
Почта, это конечно хорошо, но кто же в двадцать первом веке посылает
сообщения открытым текстом?! Поэтому поддержка шифрования в почте вещь
совершенно необходимая. Вот и wanderlust можно настроить для работы с
gnu-gpg. Базовыя статья по установке, на которую я опирался:
&lt;a href="<a href="http://box.matto.nl/wanderlustgpg.html">http://box.matto.nl/wanderlustgpg.html</a>"&gt;<a href="http://box.matto.nl/wanderlustgpg.html">http://box.matto.nl/wanderlustgpg.html</a>&lt;/a&gt;
</p>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1">Инсталляция</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Первым делом скачиваем библиотеку mailcrypt c &lt;a href="<a href="http://sourceforge.net/projects/mailcrypt/files/mailcrypt/3.5.8/mailcrypt-3.5.8.tar.gz/download">http://sourceforge.net/projects/mailcrypt/files/mailcrypt/3.5.8/mailcrypt-3.5.8.tar.gz/download</a>"&gt;<a href="http://sourceforge.net/projects/mailcrypt/files/mailcrypt/3.5.8/mailcrypt-3.5.8.tar.gz/download">http://sourceforge.net/projects/mailcrypt/files/mailcrypt/3.5.8/mailcrypt-3.5.8.tar.gz/download</a>&lt;/a&gt;
</p>

<p>
Распаковываем ее в рабочую директорию, делаем
</p>

<div class="org-src-container">

<pre class="src src-sh">./configure
make
sudo make install
</pre>
</div>

<p>
Прописываем в &lt;code&gt;~/.emacs.d/init.el&lt;/code&gt;
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">MAILCRYPT</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">Commands:</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">M-x mc-encrypt.</span>
<span style="color: #af0000;">;;   </span><span style="color: #af0000;">M-x mc-wl-decrypt-message</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://box.matto.nl/wanderlustgpg.html</span>
(load-library <span style="color: #87005f;">"mailcrypt"</span>) <span style="color: #af0000;">; provides "mc-setversion"</span>
(mc-setversion <span style="color: #87005f;">"gpg"</span>)    <span style="color: #af0000;">; for PGP 2.6 (default); also "5.0" and "gpg"</span>

(autoload 'mc-install-write-mode <span style="color: #87005f;">"mailcrypt"</span> nil t)
(autoload 'mc-install-read-mode <span style="color: #87005f;">"mailcrypt"</span> nil t)
(add-hook 'mail-mode-hook 'mc-install-write-mode)

(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">mailcrypt</span>)
(add-hook 'wl-summary-mode-hook 'mc-install-read-mode)
(add-hook 'wl-mail-setup-hook 'mc-install-write-mode)

(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">mc-wl-verify-signature</span> ()
  (interactive)
  (save-window-excursion
    (wl-summary-jump-to-current-message)
    (mc-verify)))

(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">mc-wl-decrypt-message</span> ()
  (interactive)
  (save-window-excursion
    (wl-summary-jump-to-current-message)
    (<span style="color: #af00ff;">let</span> ((inhibit-read-only t))
      (mc-decrypt))))

(eval-after-load <span style="color: #87005f;">"mailcrypt"</span>
  '(setq mc-modes-alist
       (append
        (quote
         ((wl-draft-mode (encrypt . mc-encrypt-message)
            (sign . mc-sign-message))
          (wl-summary-mode (decrypt . mc-wl-decrypt-message)
            (verify . mc-wl-verify-signature))))
        mc-modes-alist)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2">Использование</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Теперь можно использовать команды &lt;code&gt;M-x mc-encrypt&lt;/code&gt; и
&lt;code&gt;M-x mc-wl-decrypt-message&lt;/code&gt; внутри буфера сообщения, для
шифрования и расшифровывания сообщений.
</p>

<p>
И, на всякий пожарный, инструкция по использованию шифрования в gpg на
русском: <a href="https://nordrus.org/security/gnupg_manual_linux_w_sendkey.pdf">https://nordrus.org/security/gnupg_manual_linux_w_sendkey.pdf</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">lj-update</h2>
<div class="outline-text-2" id="text-10">
<p>
Как нам обновлять свой ЖЖ прямо из Емакса? Первое, что
нужно скачать - это последний снапшот LJ-UPDATE, который находится здесь:
<a href="http://edward.oconnor.cx/ljupdate/ljupdate.tar.gz">http://edward.oconnor.cx/ljupdate/ljupdate.tar.gz</a>.
</p>

<p>
Распакуйте его в папку ~/.emacs.d/ljupdate. Еще понадобится ряд файлов, о которых сказано в
README. Это файлы http-cookies.el, http-get.el и http-post.el, их последние версии нужно взять
из <a href="http://cvs.savannah.gnu.org/viewvc/http-emacs/http-emacs/">http://cvs.savannah.gnu.org/viewvc/http-emacs/http-emacs/</a> и положить в тот-же или любой
другой каталог, который входит в load-path. После этого в init.el можно прописать следующее:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">LJ-UPDATE</span>
(add-to-list 'load-path <span style="color: #87005f;">"~/.emacs.d/ljupdate"</span>)
(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">ljupdate</span>)
</pre>
</div>

<p>
Теперь, чтобы создавать посты в ЖЖ, используйте M-x lj-compose и M-x lj-compose-submit. Также
могут призодиться команды lj-login и lj-password. Чтобы посмотреть (а потом можно и
отредактировать) свои последние записи используйте M-x lj-browse-entries. Удобно!
</p>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">MetaJump</h2>
<div class="outline-text-2" id="text-11">
<p>
Довольно часто, редактируя тексты я переношу куски из одного файла в
другой, или даже делаю это внутри одного файла. И здесь мне всегда
пригождается возможность прыгать туда и обратно, которую я тоже подсмотрел
в &lt;a href="<a href="http://kulchitsky.org/rus/linux/dotemacs.html#language">http://kulchitsky.org/rus/linux/dotemacs.html#language</a>"&gt;точках Емакс&lt;/a&gt;.
Вот как это реализовано (Meta в данном случае можно понимать как ESC),
более подробно смотрите у автора.
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1048;&#1090;&#1072;&#1082;, &#1103; &#1087;&#1088;&#1077;&#1076;&#1083;&#1072;&#1075;&#1072;&#1102; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1091; 'Meta-Meta-Shift-/' &#1076;&#1083;&#1103; &#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1079;&#1072;&#1087;&#1086;&#1084;&#1085;&#1080;&#1090;&#1100; &#1090;&#1077;&#1082;&#1091;&#1097;&#1091;&#1102; &#1087;&#1086;&#1079;&#1080;&#1094;&#1080;&#1102;</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1080; &#1082;&#1086;&#1084;&#1072;&#1085;&#1076;&#1091; 'Meta-Meta-/' &#1076;&#1083;&#1103; &#1090;&#1086;&#1075;&#1086;, &#1095;&#1090;&#1086;&#1073;&#1099; &#1087;&#1077;&#1088;&#1077;&#1081;&#1090;&#1080;</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1085;&#1072; &#1079;&#1072;&#1087;&#1086;&#1084;&#1085;&#1077;&#1085;&#1085;&#1091;&#1102; &#1087;&#1086;&#1079;&#1080;&#1094;&#1080;&#1102;, &#1087;&#1088;&#1077;&#1078;&#1076;&#1077; &#1079;&#1072;&#1087;&#1086;&#1084;&#1085;&#1080;&#1074; &#1090;&#1077;&#1082;&#1091;&#1097;&#1091;&#1102;.</span>
<span style="color: #af0000;">;;</span><span style="color: #af0000;">Toggle between saved positions as in MIM editor</span>
(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">save-point-and-switch</span> ()
  <span style="color: #87005f;">"Save current point to register 0 and go</span>
<span style="color: #87005f;">to the previously saved position"</span>
 (interactive)
 (<span style="color: #af00ff;">let</span> (temp)
   (setq temp (point-marker))
   (<span style="color: #af00ff;">when</span> (not (equal (get-register 0) nil))
     (jump-to-register 0))
   (set-register 0 temp)))

<span style="color: #af0000;">;;</span><span style="color: #af0000;">Save current position to register 0</span>
(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">save-point-only</span> ()
 <span style="color: #87005f;">"Save current point to register 0"</span>
 (interactive)
 (set-register 0 (point-marker)))

(global-set-key (kbd <span style="color: #87005f;">"\e\e/"</span>) 'save-point-and-switch)
(global-set-key (kbd <span style="color: #87005f;">"\e\e?"</span>) 'save-point-only)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12">Мои мinor-режимы</h2>
<div class="outline-text-2" id="text-12">
<p>
Теперь мы поставим еще парочку расширений. Ставятся они тривиально, поэтому привожу только
код. highlight-parentheses раскрашивает скобки в разные цвета для удобного ориенитрования в
elist и lisp коде, а closure-template-html-mode - это специальный режим для редактирование
html-шаблонов. iswitchb дополняет ido-mode, о чем подробно можно прочесть в emacswiki (ссылка
приведена в комментариях)
</p>
</div>

<div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1">Настройка</h3>
<div class="outline-text-3" id="text-12-1">
<div class="org-src-container">

<pre class="src src-lisp">HIGHLIHT-PARENTHESES
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://nschum.de/src/emacs/highlight-parentheses/highlight-parentheses.el</span>
(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">highlight-parentheses</span>)
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(add-hook 'lisp-mode-hook (highlight-parentheses-mode))</span>
(<span style="color: #af00ff;">define-globalized-minor-mode</span> global-highlight-parentheses-mode
    highlight-parentheses-mode highlight-parentheses-mode)
(setq hl-paren-colors
'(<span style="color: #87005f;">"#FF0000"</span> <span style="color: #87005f;">"#FFBF00"</span> <span style="color: #87005f;">"#1FFF00"</span> <span style="color: #87005f;">"#009EFF"</span> <span style="color: #87005f;">"#2100FF"</span> <span style="color: #87005f;">"gray10"</span> <span style="color: #87005f;">"gray70"</span> <span style="color: #87005f;">"gray90"</span>))
(global-highlight-parentheses-mode)


<span style="color: #af0000;">;; </span><span style="color: #af0000;">CLOSURE-TEMPLATE-HTML-MODE</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://github.com/archimag/cl-closure-template/raw/master/closure-template-html-mode.el</span>
(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">closure-template-html-mode</span>)


<span style="color: #af0000;">;; </span><span style="color: #af0000;">ISWITCHB http://www.emacswiki.org/emacs/IswitchBuffers</span>
(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">iswitchb</span>)
(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">iswitchb-local-keys</span> ()
  (mapc (<span style="color: #af00ff;">lambda</span> (K)
          (<span style="color: #af00ff;">let*</span> ((key (car K)) (fun (cdr K)))
            (<span style="color: #af00ff;">define-key</span> iswitchb-mode-map (edmacro-parse-keys key) fun)))
        '((<span style="color: #87005f;">"&lt;right&gt;"</span> . iswitchb-next-match)
          (<span style="color: #87005f;">"&lt;left&gt;"</span>  . iswitchb-prev-match)
          (<span style="color: #87005f;">"&lt;up&gt;"</span>    . ignore             )
          (<span style="color: #87005f;">"&lt;down&gt;"</span>  . ignore             ))))
(add-hook 'iswitchb-define-mode-map-hook 'iswitchb-local-keys)
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://www.emacswiki.org/emacs/IswitchBuffers</span>
(defadvice iswitchb-kill-buffer (after rescan-after-kill activate)
  <span style="color: #87005f;">"*Regenerate the list of matching buffer names after a kill.</span>
<span style="color: #87005f;">    Necessary if using `</span><span style="color: #008787;">uniquify</span><span style="color: #87005f;">' with `</span><span style="color: #008787;">uniquify-after-kill-buffer-p</span><span style="color: #87005f;">'</span>
<span style="color: #87005f;">    set to non-nil."</span>
  (setq iswitchb-buflist iswitchb-matches)
  (iswitchb-rescan))
<span style="color: #af0000;">;; </span><span style="color: #af0000;">http://www.emacswiki.org/emacs/IswitchBuffers</span>
(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">iswitchb-rescan</span> ()
  <span style="color: #87005f;">"*Regenerate the list of matching buffer names."</span>
  (interactive)
  (iswitchb-make-buflist iswitchb-default)
  (setq iswitchb-rescan t))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13">Русификация Емакса</h2>
<div class="outline-text-2" id="text-13">
<p>
Емакс имеет встроенную и независящую от операционной системы
переключалку режимов ввода, и если ее правильно сконфигурировать - вы,
с вашим Емаксом, принесенным на флешке, сможете работать даже там, где
отсутствует поддержка национальных алфавитов.
</p>

<p>
Раскладку клавиатуры мы будем переключать по нажатию C-\, что
используется и по умолчанию и очень удобно на ноутбучных клавиатурах
hp, ну а если вам это не нравится - просто поменяйте клавишу на
удобную для вас. Привожу кусок конфига:
</p>

<div class="org-src-container">

<pre class="src src-elisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">http://kulchitsky.org/rus/linux/dotemacs.html</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1059;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1082;&#1072; &#1088;&#1072;&#1089;&#1082;&#1083;&#1072;&#1076;&#1082;&#1080; &#1082;&#1072;&#1082; &#1074; &#1074;&#1080;&#1085;&#1076;&#1086;&#1074;&#1089; &#1087;&#1088;&#1080; &#1087;&#1077;&#1088;&#1077;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1080; &#1087;&#1086; &#1057;-\</span>
(global-set-key (kbd <span style="color: #87005f;">"\C-\\"</span>) 'user-toggle-input-method)
<span style="color: #af0000;">;</span><span style="color: #af0000;">(global-set-key (kbd "\e(") 'user-to-cyr) ; Alt+Shift+9</span>
<span style="color: #af0000;">;</span><span style="color: #af0000;">(global-set-key (kbd "\e)") 'user-to-nil) ; Alt+Shift+0</span>

(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">user-cyrillic-redefinitions</span> ()
  <span style="color: #87005f;">"Set of global keys binding for cyrillic.</span>
<span style="color: #87005f;">   This function is to be called from user-toggle-input-method"</span>
  (global-set-key (kbd <span style="color: #87005f;">"?"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(insert <span style="color: #87005f;">","</span>)))
  (global-set-key (kbd <span style="color: #87005f;">"/"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(insert <span style="color: #87005f;">"."</span>)))
  (global-set-key (kbd <span style="color: #87005f;">","</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(insert <span style="color: #87005f;">":"</span>)))
  (global-set-key (kbd <span style="color: #87005f;">":"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(insert <span style="color: #87005f;">"%"</span>)))
  (global-set-key (kbd <span style="color: #87005f;">"*"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(insert <span style="color: #87005f;">";"</span>)))
  (global-set-key (kbd <span style="color: #87005f;">";"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(insert <span style="color: #87005f;">"*"</span>)))
  (global-set-key (kbd <span style="color: #87005f;">"."</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(insert <span style="color: #87005f;">"?"</span>))))

(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">user-nil-redefinitions</span> ()
 <span style="color: #87005f;">"Restoring global keys binding after user-cyrillic-redefinitions.</span>
<span style="color: #87005f;">  This function is to be called from user-toggle-input-method"</span>
  (global-set-key (kbd <span style="color: #87005f;">"?"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1)))
  (global-set-key (kbd <span style="color: #87005f;">"/"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1)))
  (global-set-key (kbd <span style="color: #87005f;">"$"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1)))
  (global-set-key (kbd <span style="color: #87005f;">","</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1)))
  (global-set-key (kbd <span style="color: #87005f;">":"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1)))
  (global-set-key (kbd <span style="color: #87005f;">"*"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1)))
  (global-set-key (kbd <span style="color: #87005f;">";"</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1)))
  (global-set-key (kbd <span style="color: #87005f;">"."</span>) (<span style="color: #af00ff;">lambda</span>()(<span style="color: #af00ff;">interactive</span>)(self-insert-command 1))))

(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">user-toggle-input-method</span> ()
  <span style="color: #87005f;">"Change the stadart function tuggle-input-method</span>
<span style="color: #87005f;">   to redefine keys for cyrillic input from UNIX type to win type"</span>
  (<span style="color: #af00ff;">interactive</span>)
  (toggle-input-method)
  (<span style="color: #af00ff;">if</span> (string= current-input-method <span style="color: #87005f;">"cyrillic-jcuken"</span>)
      (user-cyrillic-redefinitions)
    (user-nil-redefinitions))
  (message <span style="color: #87005f;">"keybord changed to %s"</span> current-input-method))

(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">user-to-cyr</span> ()
  <span style="color: #87005f;">"Change input method to Cyrillic,</span>
<span style="color: #87005f;">   I bound this function with Alt-Shift-9, that is M-("</span>
  (<span style="color: #af00ff;">interactive</span>)
  (<span style="color: #af00ff;">when</span> (string= current-input-method nil)
      (user-toggle-input-method)))

(<span style="color: #af00ff;">defun</span> <span style="color: #0000ff;">user-to-nil</span> ()
  <span style="color: #87005f;">"Change input method to nil (generally to English),</span>
<span style="color: #87005f;">   I bound this function with Alt-Sfift-0 that is M-)"</span>
  (<span style="color: #af00ff;">interactive</span>)
  (<span style="color: #af00ff;">when</span> (string= current-input-method <span style="color: #87005f;">"cyrillic-jcuken"</span>)
      (user-toggle-input-method)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14">Полезные мелочи</h2>
<div class="outline-text-2" id="text-14">
<p>
Сейчас мы продолжим конфигурирование нашего Емакса, чтобы сделать его
максимально удобным для жизни. Так например, при выполнении команды
ls в shell Емакс не преобразовывает escape-последовательности в
правильные цвета, на что жалуются новички. Не проблема - сейчас мы это
поправим! Добавляем в наш ~/.emacs.d/init.el :
</p>

<p>
;; для корректного выведения escape-последовательностей shell`a
</p>

<div class="org-src-container">

<pre class="src src-lisp">(add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on)
</pre>
</div>

<p>
Еще одна головная боль - автоопределение кодировок. Иногда не
срабатывает на коротких текстах :) Поэтому важно расставить
приоритеты:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1059;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1082;&#1080; &#1072;&#1074;&#1090;&#1086;&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1077;&#1085;&#1080;&#1103; &#1082;&#1086;&#1076;&#1080;&#1088;&#1086;&#1074;&#1086;&#1082;. &#1055;&#1077;&#1088;&#1074;&#1086;&#1081; &#1073;&#1091;&#1076;&#1077;&#1090; &#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1090;&#1100;&#1089;&#1103; utf-8-unix</span>
(prefer-coding-system 'cp866)
(prefer-coding-system 'koi8-r-unix)
(prefer-coding-system 'windows-1251-dos)
(prefer-coding-system 'utf-8-unix)
</pre>
</div>

<p>
Теперь сделаем режим по умолчанию более удобным для использования. Я
хочу, чтобы в нем набираемая строка автоматически переносилась по
словам когда ее размер приближается к 80 символам:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1056;&#1077;&#1078;&#1080;&#1084; &#1087;&#1086; &#1091;&#1084;&#1086;&#1083;&#1095;&#1072;&#1085;&#1080;&#1102; c &#1087;&#1077;&#1088;&#1077;&#1085;&#1086;&#1089;&#1086;&#1084; &#1089;&#1090;&#1088;&#1086;&#1082; &#1087;&#1086; &#1096;&#1080;&#1088;&#1080;&#1085;&#1077; 80</span>
(setq default-major-mode 'text-mode)
(add-hook 'text-mode-hook 'turn-on-auto-fill)
(setq auto-fill-mode t)
(setq fill-column 80)
</pre>
</div>

<p>
Важная задача - сохранение файлов. По умолчанию все текстовые
редакторы стараются создавать бэкап-файлы в каталоге, где лежит
редактируемый файл и из-за этого бэкап-файлы часто попадают в
репозиторий, что само по себе неаккуратно. Настроим себе более умный
бэкап:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1059;&#1076;&#1072;&#1083;&#1103;&#1077;&#1084; &#1086;&#1082;&#1086;&#1085;&#1077;&#1095;&#1085;&#1099;&#1077; &#1087;&#1088;&#1086;&#1073;&#1077;&#1083;&#1099; &#1087;&#1077;&#1088;&#1077;&#1076; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1080;&#1077;&#1084; &#1092;&#1072;&#1081;&#1083;&#1086;&#1074;</span>
(add-hook 'before-save-hook '(<span style="color: #af00ff;">lambda</span> ()
(delete-trailing-whitespace)))
<span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1057;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077; &#1088;&#1077;&#1079;&#1077;&#1088;&#1074;&#1085;&#1099;&#1093; &#1082;&#1086;&#1087;&#1080;&#1081; &#1088;&#1077;&#1076;&#1072;&#1082;&#1090;&#1080;&#1088;&#1091;&#1077;&#1084;&#1099;&#1093; &#1092;&#1072;&#1081;&#1083;&#1086;&#1074; (Backup)</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1085;&#1091;&#1084;&#1077;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1081; &#1073;&#1101;&#1082;&#1072;&#1087; - 2 &#1087;&#1077;&#1088;&#1074;&#1099;&#1093; &#1080; 2 &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1080;&#1093;</span>
(setq  backup-by-copying t      <span style="color: #af0000;">; don't clobber symlinks</span>
       backup-directory-alist  '((<span style="color: #87005f;">"."</span> . <span style="color: #87005f;">"~/backup"</span>))    <span style="color: #af0000;">; don't litter my fs tree</span>
       delete-old-versions t            <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1091;&#1076;&#1072;&#1083;&#1077;&#1085;&#1080;&#1077; &#1087;&#1088;&#1086;&#1084;&#1077;&#1078;&#1091;&#1090;&#1086;&#1095;&#1085;&#1099;&#1093; &#1073;&#1101;&#1082;&#1072;&#1087;&#1086;&#1074;</span>
       kept-new-versions 6
       kept-old-versions 2
       version-control t)       <span style="color: #af0000;">; use versioned backups</span>
</pre>
</div>

<p>
И наконец, слегда адаптируем под свои нужны интерфейс - следите за
комментариями:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1048;&#1085;&#1090;&#1077;&#1088;&#1092;&#1077;&#1081;&#1089;</span>
(setq transient-mark-mode '1)           <span style="color: #af0000;">;; </span><span style="color: #af0000;">Show marked text</span>
(setq font-lock-maximum-decoration t)   <span style="color: #af0000;">;;</span>
(set-scroll-bar-mode 'right)            <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1055;&#1086;&#1083;&#1086;&#1089;&#1072; &#1087;&#1088;&#1086;&#1082;&#1088;&#1091;&#1090;&#1082;&#1080; &#1089;&#1087;&#1088;&#1072;&#1074;&#1072;</span>
(setq inhibit-startup-message t)        <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1053;&#1077; &#1087;&#1086;&#1082;&#1072;&#1079;&#1099;&#1074;&#1072;&#1077;&#1084; &#1089;&#1086;&#1086;&#1073;&#1097;&#1077;&#1085;&#1080;&#1077; &#1087;&#1088;&#1080; &#1089;&#1090;&#1072;&#1088;&#1090;&#1077;</span>
(fset 'yes-or-no-p 'y-or-n-p)       <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1085;&#1077; &#1079;&#1072;&#1089;&#1090;&#1072;&#1074;&#1083;&#1103;&#1081;&#1090;&#1077; &#1084;&#1077;&#1085;&#1103; &#1087;&#1077;&#1095;&#1072;&#1090;&#1100; "yes" &#1094;&#1077;&#1083;&#1080;&#1082;&#1086;&#1084;</span>
(setq default-tab-width 4)              <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1090;&#1072;&#1073;&#1091;&#1083;&#1103;&#1094;&#1080;&#1080;</span>
(setq-default indent-tabs-mode nil)     <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1086;&#1090;&#1089;&#1090;&#1091;&#1087; &#1090;&#1086;&#1083;&#1100;&#1082;&#1086; &#1087;&#1088;&#1086;&#1073;&#1077;&#1083;&#1072;&#1084;&#1080;</span>
(setq initial-scratch-message nil)      <span style="color: #af0000;">;; </span><span style="color: #af0000;">Scratch buffer settings. &#1054;&#1095;&#1080;&#1097;&#1072;&#1077;&#1084; &#1077;&#1075;&#1086;.</span>
(setq scroll-conservatively 50)         <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1075;&#1083;&#1072;&#1076;&#1082;&#1080;&#1081; &#1089;&#1082;&#1088;&#1086;&#1083;&#1083;&#1080;&#1085;&#1075; &#1089; &#1087;&#1086;&#1083;&#1103;&#1084;&#1080;</span>
(setq scroll-preserve-screen-position 't)
(setq scroll-margin 10)
(setq column-number-mode t)             <span style="color: #af0000;">;; </span><span style="color: #af0000;">show column &amp; line numbers in status bar</span>
(setq line-number-mode t)
(setq my-author-name (getenv <span style="color: #87005f;">"USER"</span>))
(setq user-full-name (getenv <span style="color: #87005f;">"USER"</span>))
(recentf-mode 1)                        <span style="color: #af0000;">;; </span><span style="color: #af0000;">Recent files in menu</span>
<span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1084;&#1099;&#1096;&#1082;&#1072;...</span>
(global-set-key [vertical-scroll-bar down-mouse-1] 'scroll-bar-drag)
                                    <span style="color: #af0000;">;; </span><span style="color: #af0000;">Scroll Bar gets dragged by mouse butn 1</span>
(setq mouse-yank-at-point 't)       <span style="color: #af0000;">;; </span><span style="color: #af0000;">Paste at point NOT at cursor</span>
(mouse-wheel-mode 1)            <span style="color: #af0000;">;; </span><span style="color: #af0000;">&#1082;&#1086;&#1083;&#1077;&#1089;&#1086; &#1084;&#1099;&#1096;&#1082;&#1080;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15">uniquify</h2>
<div class="outline-text-2" id="text-15">
<p>
Я выбрал uniquify - маленькую библитечку, распространяемую вместе с
Емаксом (то есть качать ничего не надо), которая улучшает способ
работы Емакса с буферами, которые отображают файлы с одинаковыми
именами. Более подробную информацию о ней можно посмотреть на
emacswiki.org: <a href="http://emacswiki.org/emacs/uniquify">http://emacswiki.org/emacs/uniquify</a>
</p>

<p>
По умолчанию, Емакс отображает (в списке буферов) такие буферы как
filename, filename&lt;2&gt;, filename&lt;3&gt; и так далее. А uniquify отображает
в имени буфера кусок различающегося пути: filename/folger1,
filename/folger2 etc, что несомненно удобнее.
</p>

<p>
Итак чтобы подключить uniquify вы должны вставить в свой
~/.emacs.d/init.el следующий код:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #af0000;">;; </span><span style="color: #af0000;">http://emacswiki.org/emacs/uniquify</span>
(<span style="color: #af00ff;">require</span> '<span style="color: #008787;">uniquify</span>)
<span style="color: #af0000;">;; </span><span style="color: #af0000;">(setq uniquify-buffer-name-style t)</span>
(setq uniquify-buffer-name-style 'reverse)
(setq uniquify-separator <span style="color: #87005f;">"/"</span>)
(setq uniquify-after-kill-buffer-p t)
(setq uniquify-ignore-buffers-re <span style="color: #87005f;">"^\\*"</span>)
(setq post-forward-angle-brackets 'post-forward-angle-brackets)
</pre>
</div>
</div>
</div>
</div>
</body>
</html>
