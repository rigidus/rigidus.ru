<!DOCTYPE html>
<html>
<head>
<title>Контракты в DAG</title>
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="rigidus">
<link href="/css/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="content">
<h1 class="title">Контракты в DAG</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Интро</a></li>
<li><a href="#sec-2">Протокол взаимодействия</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Интро</h2>
<div class="outline-text-2" id="text-1">
<p>
Этот документ описывает криптографический протокол выполнения контракта в направленном
ацикликлическом графе. Это модельный пример, предназначенный для иллюстрации идеи. Он
может быть изменен ради поддержки более сложных видов контрактов.
</p>

<p>
В сценарии контракта участвуют <code>Продавец</code> и <code>Покупатель</code>. <code>Продавец</code> предлагает сделку,
а <code>Покупатель</code> расплачивается за нее, создавая транзакцию перевода денег продавцу,
которую децентрализованная сеть апрувит только в том случае, если <code>Покупатель</code> будет
удовлетворен. В противном случае транзакция перевда денег продавцу не будет
подтверждена.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Протокол взаимодействия</h2>
<div class="outline-text-2" id="text-2">
<p>
<div class="figure"><img src="/img/dag-contract.png" alt="nil"/><p></p></div>
</p>

<ul class="org-ul">
<li>Продавец формирует предложение о сделке и отправляет его в сеть как обычную
транзакцию, содержащую информацию о условиях сделки. Назовем эту транзакцию
<code>deal</code>. Эта транзакция будет подтверждена сетью на общих основаниях.
</li>
<li>Покупатель выбирает среди подтвержденных сетью транзакцию <code>secret</code> и складывает ее
хэш с хешем <code>deal</code>. Результат сложения хэшируется и становится приватным ключем
<code>private</code>. Из этого приватного ключа тривиально получает публичный ключ <code>public</code>. Эту
пару ключей Покупатель сохраняет у себя.
</li>
<li>Покупатель создает транзакцию перевода средств Продавцу (<code>transfer</code>). Транзакция
ссылается на <code>deal</code> и кошелек Покупателя (<code>wallet</code>). Эта транзакция подписана ключом
<code>private</code>. Эту транзакцию сеть пока не может подтвердить, так как для проверки
подписи необходимо знать <code>public</code>, а его Покупатель пока не раскрыл.
</li>
<li>Продавец высылает товар, Покупатель его получает.
</li>
<li>Если Покупатель доволен, он раскрывает <code>public</code> создавая транзакцию <code>expose</code>, которая
его содержит. Эта транзакция ссылается на <code>transfer</code>, чтобы явно указать, что
подтверждает его. Теперь у сети есть достаточно данных, чтобы подтвердить
транзакцию. Если же Покупатель не доволен, то он ничего не делает и транзакция
остается неподтвержденной.
</li>
<li>Опциональный шаг: Покупатель может раскрыть <code>private</code>, создав транзакцию <code>prove</code>,
которая ссылается на <code>secret</code> (и на <code>transfer</code>).
</li>
</ul>
</div>
</div>
</div>
</body>
</html>
